<?php // $Id mod.html,v 1.5 2006/10/07 122857 gustav_delius Exp $
/**
 * This page defines the form to create or edit an instance of this module
 * It is used from /course/mod.php.  The whole instance is available as $form.
 *
 * @author 
 * @version $Id mod.html,v 1.5 2006/10/07 122857 gustav_delius Exp $
 * @package referentiel
 **/
// DEBUG
// echo "<br />MODE $mode\n";

if (!empty($record) && !empty($course)){ 
	// une enregistrement activite est charge
	
	
	/////////////////// MODIFIER ////////////////////////////////////////////
	if (isset($mode) && ($mode=="updateactivity")){

		if (!isset($form->approved)) {
    		$form->approved=0;
		}	
		if (!isset($form->userid)) {
    		$form->userid=$USER->id;
		}
		if (!isset($form->teacherid)) {
    		$form->teacherid=0;
		}
		
		if (!isset($form->course)) {
    		$form->course = $course->id;
		}		
		if (!isset($form->sesskey)) {
    		$form->sesskey=sesskey();
		}
		if (!isset($form->modulename)) {
    		$form->modulename='referentiel';
		}
		if (!isset($form->instance)) {
    		$form->instance=$referentiel->id;
		}
		
		if (!isset($form->activite_id)) {
			if (isset($activite_id))
				$form->activite_id=$activite_id;
			else
				$form->activite_id='';
		}
        if (!isset($form->mailnow)) {
				$form->mailnow='';
		}
		
		// preparer les variables globales pour Overlib
		if (isset($referentiel_referentiel->id) && ($referentiel_referentiel->id>0)){
			referentiel_initialise_data_referentiel($referentiel_referentiel->id);
		}

		// Charger les activites
		// filtres
    	$context = get_context_instance(CONTEXT_MODULE, $cm->id);
	
		$isteacher = has_capability('mod/referentiel:approve', $context);
		$isauthor = has_capability('mod/referentiel:write', $context) && !$isteacher;
		$iseditor = has_capability('mod/referentiel:writereferentiel', $context);	

		$liste_codes_competence=referentiel_get_liste_codes_competence($referentiel_referentiel->id);	
		// DEBUG
		// echo "<br/>DEBUG<br />\n";
		// print_object($record);
	
    	$activite_id=$record->id;
		$type_activite = stripslashes($record->type);
		$description = stripslashes(strip_tags($record->description));
		$comptencies = stripslashes(strip_tags($record->comptencies));
		$comment = stripslashes(strip_tags($record->comment));
		$instanceid = $record->instanceid;
		$referentielid = $record->referentielid;
		$course = $record->course;
		$userid = $record->userid;
		$teacherid = $record->teacherid;
		if ($teacherid==0){
			if ($isteacher || $iseditor){ 
				$teacherid=$USER->id;
			}
		} 

		$timecreated = $record->timecreated;
		$timemodified = $record->timemodified;
		$approved = $record->approved;
		$taskid = $record->taskid;
		if ($taskid>0){ // remplacer par la liste definie dans la tache
			$liste_codes_competences_tache=referentiel_get_liste_codes_competence_tache($taskid);
			// DEBUG
			// echo "<br/>DEBUG<br />\n";
			// echo $liste_codes_competences_tache;				
		} 
		else{
			$liste_codes_competences_tache=$liste_codes_competence;
		}
		// DEBUG
		// echo "<br/>DEBUG<br />\n";
		// print_object($record);
		
		$user_info=referentiel_get_user_info($userid);
		$teacher_info=referentiel_get_user_info($teacherid);
		// dates
		$date_creation_info=userdate($timecreated);		
		if ($timemodified){
            $date_modif_info=userdate($timemodified);
		}
		else {
            $date_modif_info='';
        }
		
		// MODIF JF 2009/10/27
		$timemodifiedstudent = $record->timemodifiedstudent;
		if ($timemodifiedstudent!=0){
			$date_modif_student_info=userdate($timemodifiedstudent);
		}
		else{
			$date_modif_student_info='';
		}
		
		// MODIF JF 2009/10/21						
		$form->old_liste_competences=stripslashes($record->comptencies);		
		
		// LISTE DES COMPETENCES DECLAREES
		
$jauge_activite_declarees=referentiel_print_jauge_activite($userid, $referentielid);
if ($jauge_activite_declarees){
	print_string('competences_declarees','referentiel', referentiel_get_user_info($userid));
	echo '<br />';
	echo $jauge_activite_declarees."\n";
	echo '<br />';
}


		// AFFICHER ACTIVITE
?>

<table align="center" width="100%" cellspacing="1" cellpadding="4" bgcolor="#555533">
<tr valign="top">
<td  bgcolor="#eeeeff">
<h3><?php  print_string('modifier_activite','referentiel') ?></h3>
<form name="form" method="post" action="<?php p("activite.php?d=$referentiel->id") ?>">

<table align="center" cellpadding="5" width="90%">
<tr valign="top">
    <td align="center">
<b><?php  print_string('id','referentiel') ?></b> <?php p($activite_id) ?>
    </td>
    <td align="center">
<b><?php print_string('auteur','referentiel') ?></b> <?php p($user_info) ?>
    </td>
    <td align="center">
<b><?php print_string('evaluation_par','referentiel') ?></b> <?php p($teacher_info) ?>
    </td>
    <td align="center">
<b><?php  print_string('timecreated','referentiel') ?></b> <?php p($date_creation_info) ?>
<input type="hidden" name="timecreated" value="<?php  p($timecreated) ?>" />
    </td>		
    <td align="center">
<b><?php  print_string('timemodified','referentiel') ?></b> <?php p($date_modif_info) ?>	
<input type="hidden" name="timemodified" value="<?php  p($timemodified) ?>" />
    </td>		
    <td align="center">
<b><?php  print_string('timemodifiedstudent','referentiel') ?></b> <?php p($date_modif_student_info) ?>	
<input type="hidden" name="timemodifiedstudent" value="<?php  p($timemodifiedstudent) ?>" />
    </td>		
</tr>
</table>
<table cellpadding="5" width="90%">
<tr valign="top">
    <td align="right">
     <b><?php   print_string('validation','referentiel') ?> </b>
    </td>
	<td align="left">

<?php
		if (has_capability('mod/referentiel:approve', $context)){
			if (isset($approved) && ($approved)){
				// print_string('approved','referentiel');
				echo '<input type="radio" name="approved" value="1" checked="checked" />'.get_string('yes').' &nbsp; <input type="radio" name="approved" value="0" />'.get_string('no').' &nbsp; &nbsp; '."\n";
			}
			else{
				// print_string('not_approved','referentiel');
				echo '<input type="radio" name="approved" value="1" />'.get_string('yes').' &nbsp; <input type="radio" name="approved" value="0" checked="checked" />'.get_string('no').' &nbsp; &nbsp; '."\n";
			}
		}
		else{
			if (isset($approved) && ($approved)){
				print_string('approved','referentiel');
			}
			else{
				print_string('not_approved','referentiel');
			}
			echo '<input type="hidden" name="approved" value="'.$approved.'" />'."\n";
		}


?>
    </td>
    <td align="right">
     <b><?php   print_string('notification_activite','referentiel') ?> </b>
    </td>
	<td align="left">

<?php
		echo '<input type="radio" name="mailnow" value="1" />'.get_string('yes').' &nbsp; <input type="radio" name="mailnow" value="0" checked="checked" />'.get_string('no').' &nbsp; &nbsp; '."\n";
?>
    </td>
</tr>

<tr valign="top">
    <td align="right">
	<b><?php  print_string('type','referentiel') ?></b>
	</td>
    <td align="left" colspan="3">
<input type="text" name="type" size="80" maxlength="80" value="<?php  p($type_activite) ?>" />	
    </td>
</tr>
<tr valign="top">
    <td align="right">
	<b><?php  print_string('description','referentiel') ?></b>
	</td>
<?php
		if (isset($approved) && ($approved)){
			echo '<td class="valide"  colspan="3">';
		}
		else{
			echo '<td class="invalide" colspan="3">';
		}
?>

<textarea cols="80" rows="10" name="description"><?php  p($description) ?></textarea>
    </td>
</tr>
<?php  
	echo '
<tr valign="top">
    <td align="right">
	<b>
';

    if ($taskid==0) { // activite normale
	   print_string('aide_saisie_competences','referentiel');

        echo '</b></td>'."\n";
        if (isset($approved) && ($approved)){
            echo '<td class="valide"  colspan="3">';
        }
        else{
            echo '<td class="invalide" colspan="3">';
        }
        referentiel_modifier_selection_liste_codes_item_competence('/', $liste_codes_competence, $comptencies, false);
    }
    else{ // activite issue d'une tache
    	print_string('competences_bloquees','referentiel');
        echo '</b></td>'."\n";
        if (isset($approved) && ($approved)){
            echo '<td class="valide"  colspan="3">';
        }
        else{
            echo '<td class="invalide" colspan="3">';
        }
    	referentiel_modifier_selection_liste_codes_item_competence('/', $liste_codes_competences_tache, $comptencies, true );
	   echo '<input type="hidden" name="comptencies" value="'.$comptencies.'" />'."\n";
    }
echo '    </td>
</tr>
';
?>
<?php
		if (has_capability('mod/referentiel:comment', $context)){
?>
<tr valign="top">
    <td align="right">
	<b><?php  print_string('commentaire','referentiel') ?></b>
	</td>
    <td align="left" colspan="3">
<textarea cols="80" rows="10" name="comment"><?php  p($comment) ?></textarea>
    </td>
</tr>
<?php
		}
		else {
?>
<input type="hidden" name="comment" value="<?php  p($comment) ?>" />
<?php
		}		
			// MODIF 2009/10/20
		
?>

<tr valign="top">
    <td align="center" colspan="4">

<input type="hidden" name="select_acc" value="<?php echo $select_acc; ?>" />
<input type="hidden" name="old_liste_competences" value="<?php p($form->old_liste_competences); ?>" />
<input type="hidden" name="userid" value="<?php  p($userid) ?>" />
<input type="hidden" name="teacherid" value="<?php  p($teacherid) ?>" />
<input type="hidden" name="activite_id" value="<?php  p($activite_id) ?>" />
<input type="hidden" name="referentielid" value="<?php  p($referentielid) ?>" />
<input type="hidden" name="course" value="<?php  p($course) ?>" />
<input type="hidden" name="instanceid" value="<?php  p($instanceid) ?>" />

<input type="hidden" name="action" value="modifier_activite" />
<!-- These hidden variables are always the same -->
<input type="hidden" name="course"        value="<?php  p($form->course) ?>" />
<input type="hidden" name="sesskey"     value="<?php  p(sesskey()) ?>" />
<input type="hidden" name="modulename"    value="<?php  p($form->modulename) ?>" />
<input type="hidden" name="instance"      value="<?php  p($form->instance) ?>" />
<input type="hidden" name="mode"          value="<?php  p($mode) ?>" />
<input type="submit" value="<?php  print_string("savechanges") ?>" />
<input type="submit" name="delete" value="<?php  print_string("delete") ?>" />
<input type="submit" name="cancel" value="<?php  print_string("quit","referentiel") ?>" />
</td></tr>
</table>

</form>	
</td>
<td>
<!-- NOUVEAU DOCUMENT -->
<?php

		// AJOUTER un document
		if (!isset($form->description)) {
		   	$form->description = 'INCONNU';
		}
		if (!isset($form->type)) {
		   	$form->type = 'A COMPLETER';
		}
		if (!isset($form->url)) {
		   	$form->url = '';
		}

        $s1='
<form name="form" method="post" action="upload.php?d='.$referentiel->id.'">

<table align="center" cellpadding="5" bgcolor="#ffeeee">
<tr valign="top">
    <td align="center"><b>'.get_string('document_associe','referentiel').'</b>
</td>
</tr>
<!-- tr valign="top">
    <td align="left">
<input type="radio" name="depot_document" value="'.get_string('yes').'" />'.get_string('yes').'
<input type="radio" name="depot_document" value="'.get_string('no').'" checked="checked" /> '.get_string('no').'
    </td>
</tr -->
<tr valign="top">
    <td align="center">
<input type="hidden" name="select_acc" value="'.$select_acc.'" />
<input type="hidden" name="old_liste_competences" value="'.$form->old_liste_competences.'" />
<input type="hidden" name="activityid" value="'.$activite_id.'" />
<input type="hidden" name="approved" value="'.$approved.'" />
<input type="hidden" name="userid" value="'.$userid.'" />
<input type="hidden" name="teacherid" value="'.$teacherid.'" />
<input type="hidden" name="activite_id" value="'.$activite_id.'" />
<input type="hidden" name="referentielid" value="'.$referentielid.'" />
<input type="hidden" name="course" value="'.$course.'" />
<input type="hidden" name="instanceid" value="'.$instanceid.'" />
<input type="hidden" name="action" value="creer_document" />
<!-- These hidden variables are always the same -->
<input type="hidden" name="course"        value="'.$form->course.'" />
<input type="hidden" name="sesskey"     value="'.sesskey().'" />
<input type="hidden" name="modulename"    value="'.$form->modulename.'" />
<input type="hidden" name="instance"      value="'.$form->instance.'" />
<input type="hidden" name="mode"          value="'.$mode.'" />
<input type="submit" value="'.get_string('document_ajout', 'referentiel').'" />
<!-- input type="submit" name="cancel" value="'.get_string("quit","referentiel").'" / -->
</td></tr>
';
        $s2='';
        $s3='';
        $s='';
        $links_documents='<br><br>';
		// Recuperer les documents associes à l'activite
		$records_document = referentiel_get_documents($activite_id);
	    if ($records_document){
    		// afficher
			// DEBUG
			// echo "<br/>DEBUG<br />\n";
			// print_r($records_document);
            $nbressource=count($records_document);
            $s2.='<tr bgcolor="#ffffff"><td>';
            if ($nbressource>1){
            		$s2.=get_string('ressources_associees','referentiel',$nbressource);
            }
            else{
            		$s2.=get_string('ressource_associee','referentiel',$nbressource);
            }
            $s3.='</td></tr>
</table>
</form>
</td>
</tr>
';
            $s.= '<tr valign="top" bgcolor="#ffffee">
    <td align="center" colspan="2">'.get_string('document_associe','referentiel').'</b>
    </td></tr>'."\n";

			$compteur_document=0;
			foreach ($records_document as $record_d){
                if ($compteur_document%2==0)
                    $bgcolor="#afefee";
                else
                    $bgcolor="#faefee";
				$compteur_document++;
        		$document_id=$record_d->id;
				$type = stripslashes($record_d->type);
				$description = stripslashes($record_d->description);
				$url = stripslashes($record_d->url);
				$activityid = $record_d->activityid;
				$target = $record_d->target; // fenêtre cible
				$label = $record_d->label; // etiquette

				$links_documents.=referentiel_affiche_url($url, $label, $target).'<br />';

                $s.='<!-- DOCUMENT -->
<tr valign="top" bgcolor="'.$bgcolor.'">
<td colspan="2">
';

                $s.='
<form name="form" method="post" action="activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'">
<input type="hidden" name="activityid" value="'.$activityid.'" />
<input type="hidden" name="document_id" value="'.$document_id.'" />

<table cellpadding="5" width="100%">
<tr valign="top" bgcolor="'.$bgcolor.'">
<td width="40" rowspan="2">
<b>'.get_string('num','referentiel').'</b>
<i>'.$document_id.'</i>
</td>
<td colspan="2">
	<b>'.get_string('description','referentiel').'</b>
	<br>
<textarea cols="70" rows="2" name="description">'.$description.'</textarea>
</td>
<td>
<b>'.get_string('type','referentiel').'</b>  :
<i><span class="small">'.get_string('extensions_document','referentiel').'</span></i>
<input type="text" name="type" size="10" maxlength="20" value="'.$type.'" />
</td>
</tr>
<tr valign="top" bgcolor="'.$bgcolor.'">
<td><b>'.get_string('url','referentiel').'</b>    :
<input type="text" name="url" size="50" maxlength="255" value="'.$url.'" />
</td><td>'. get_string('label','referentiel').' :
<input type="text" name="label" size="40" maxlength="255" value="'.$label.'" />
</td><td>'. get_string('cible_link','referentiel').' '."\n";
	if ($target){
		$s.=' <input type="radio" name="target" value="1" checked="checked" />'.get_string('yes').'
<input type="radio" name="target" value="0" />'.get_string('no')."\n";
	}
	else{
		$s.=' <input type="radio" name="target" value="1" />'.get_string('yes').'
<input type="radio" name="target" value="0" checked="checked" />'.get_string('no')."\n";
	}
    $s.='</td>
</tr>
<tr valign="top" bgcolor="'.$bgcolor.'">
<td align="center" colspan="4">
<input type="hidden" name="select_acc" value="'.$select_acc.'" />
<input type="hidden" name="old_liste_competences" value="'.$form->old_liste_competences.'" />
<input type="hidden" name="approved" value="'.$approved.'" />
<input type="hidden" name="userid" value="'.$userid.'" />
<input type="hidden" name="teacherid" value="'.$teacherid.'" />
<input type="hidden" name="activite_id" value="'.$activite_id.'" />
<input type="hidden" name="referentielid" value="'.$referentielid.'" />
<input type="hidden" name="course" value="'.$course.'" />
<input type="hidden" name="instanceid" value="'.$instanceid.'" />

<input type="hidden" name="action" value="modifier_document" />
<!-- These hidden variables are always the same -->
<input type="hidden" name="course"        value="'.$form->course.'" />
<input type="hidden" name="sesskey"     value="'.sesskey().'" />
<input type="hidden" name="modulename"    value="'.$form->modulename.'" />
<input type="hidden" name="instance"      value="'.$form->instance.'" />
<input type="hidden" name="mode"          value="'.$mode.'" />
<input type="submit" value="'.get_string("savedoc", "referentiel").'" />
<input type="submit" name="delete" value="'.get_string("delete").'" />
<!-- input type="submit" name="cancel" value='.get_string("quit","referentiel").' / -->
</td></tr></table>
</form>	
</td>
</tr>
';
			}
		}
		else{  // pas de documents enregistrés
            $s.='
</table>
</form>
</td>
</tr>
';
        }
        // affichage
        echo $s1;
        echo $s2;
        echo $links_documents;
        echo $s3;
        echo $s;
        
?>
</table>
<?php

	}
	/////////////////// FIN MODIFIER ////////////////////////////////////////////

	/////////////////// SUPPRIMER ////////////////////////////////////////////
	else if (isset($mode) && ($mode=="deleteactivity")){
		/// Confirmer la suppression d'un enregistrement
		if (isset($activite_id) && ($activite_id>0)){
			notice_yesno(get_string('confirmdeleterecord','referentiel'),
			'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;delete='.$activite_id.'&amp;userid='.$userid.'&amp;mode='.$old_mode.'&amp;confirm=1&amp;sesskey='.sesskey(),
	        'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;userid='.$userid.'&amp;mode='.$old_mode.'&amp;sesskey='.sesskey());
		}
		else{
			error(get_string('noactivite','referentiel'), "activite.php?d=$referentiel_instance->id&amp;mode='.$old_mode.'");
		}
	} 
	/////////////////// VALIDER ////////////////////////////////////////////	
	else if (isset($mode) && ($mode=="approveactivity")){
		if (isset($activite_id) && ($activite_id>0)){
			notice_yesno(get_string('confirmvalidateactivity','referentiel'),
			'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;approve='.$activite_id.'&amp;userid='.$userid.'&amp;confirm=1&amp;mode='.$old_mode.'&amp;sesskey='.sesskey(),
			'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;approve='.$activite_id.'&amp;userid='.$userid.'&amp;confirm=0&amp;mode='.$old_mode.'&amp;sesskey='.sesskey());
		}
		else{
			error(get_string('noactivite','referentiel'), "activite.php?d=$referentiel_instance->id.'&amp;userid='.$userid.'&amp;mode='.$old_mode.'");
		}
	} 
	/////////////////// DE-VALIDER ////////////////////////////////////////////	
	else if (isset($mode) && ($mode=="desapproveactivity")){
		if (isset($activite_id) && ($activite_id>0)){
			notice_yesno(get_string('confirmdevalidateactivity','referentiel'),
			'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;approve='.$activite_id.'&amp;userid='.$userid.'&amp;confirm=0&amp;mode='.$old_mode.'&amp;sesskey='.sesskey(),
			'activite.php?d='.$referentiel->id.'&amp;select_acc='.$select_acc.'&amp;approve='.$activite_id.'&amp;userid='.$userid.'&amp;confirm=1&amp;mode='.$old_mode.'&amp;sesskey='.sesskey());
		}
		else{
			error(get_string('noactivite','referentiel'), "activite.php?d=$referentiel_instance->id.'&amp;userid='.$userid.'&amp;mode='.$old_mode.'");
		}
	}	
	
	/////////////////// COMMENTER //////////////////////////////////////////// 
	else if (isset($mode) && ($mode=="commentactivity")){

		$activite_id=$record->id;
		$type_activite = stripslashes($record->type);
		$description = stripslashes($record->description);
		$comptencies = stripslashes($record->comptencies);
		$comment = stripslashes($record->comment);
		$instanceid = $record->instanceid;
		$referentielid = $record->referentielid;
		$course = $record->course;
		$userid = $record->userid;
		$teacherid = $record->teacherid;
		$timecreated = $record->timecreated;
		$timemodified = $record->timemodified;
		$approved = $record->approved;
		
		$user_info=referentiel_get_user_info($userid);
		$teacher_info=referentiel_get_user_info($teacherid);
		// dates
		$date_creation_info=userdate($timecreated);		
		if ($timemodified!=0){
            $date_modif_info=userdate($timemodified);
		}
		else{
            $date_modif_info='';
        }
		// MODIF JF 27/10/2009
		$timemodifiedstudent = $record->timemodifiedstudent;
		if ($timemodifiedstudent!=0){
			$date_modif_student_info=userdate($timemodifiedstudent);
		}
		else{
			$date_modif_student_info='';
		}
			
?>
<form name="form" method="post" action="<?php p("activite.php?d=$referentiel->id") ?>">

<table cellpadding="5">
<tr valign="top">
    <td>
	<b><?php  print_string('id','referentiel'); ?> </b>

	<?php  p($activite_id) ?>
    </td>
    <td>
	<b><?php  print_string('type_activite','referentiel') ?></b>

            <?php  p($type_activite) ?>
    </td>
    <td>
     <b><?php print_string('auteur','referentiel')?> </b>

    		<?php p($user_info) ?>
    </td>
	<td>
	<b><?php  print_string('timecreated','referentiel') ?> </b>

		<?php  p($date_creation_info);; ?>
    </td>		
</tr>
<tr valign="top">
    <td colspan="4">
	<b><?php  print_string('description','referentiel') ?></b>
<br />
        <?php  echo (nl2br($description)); ?>
    </td>
</tr>
<tr valign="top">
    <td  colspan="4">
	<b><?php  print_string('liste_codes_competence','referentiel') ?> </b>
		<?php  echo referentiel_affiche_liste_codes_competence('/',$comptencies); ?>
    </td>
</tr>

<tr valign="top" bgcolor="#ffeeee">
    <td  colspan="4">
	<b><?php  print_string('commentaire','referentiel') ?></b>
<br />
<textarea cols="100" rows="10" name="comment"><?php  echo $comment; ?></textarea>
    </td>
</tr>

<tr valign="top">

    <td>
     <b><?php   print_string('referent','referentiel') ?> </b>
      <br />
	<?php p($teacher_info); ?> 
    </td>
    <td>
     <b><?php   print_string('modification','referentiel') ?></b>
<br />
	<?php  print_string('date_modif_by','referentiel'); ?>
<i>
    <?php p($date_modif_info); ?>
</i>
<br />

		<?php  print_string('date_modif_student_by','referentiel'); ?>
<i>
    <?php p($date_modif_student_info); ?>
</i>
    </td>
    <td bgcolor="#ffeeee">
     <b><?php   print_string('validation','referentiel') ?> </b>
      <br />
<?php
		if (isset($approved) && ($approved)){
			// print_string('approved','referentiel');
			echo '<input type="radio" name="approved" value="1" checked="checked" />'.get_string('yes').' &nbsp; <input type="radio" name="approved" value="0" />'.get_string('no').' &nbsp; &nbsp; '."\n";
		}
		else{
			// print_string('not_approved','referentiel');
			echo '<input type="radio" name="approved" value="1" />'.get_string('yes').' &nbsp; <input type="radio" name="approved" value="0" checked="checked" />'.get_string('no').' &nbsp; &nbsp; '."\n";
		}

?>
    </td>

    <td bgcolor="#ffeeee">
     <b><?php  print_string('notification_commentaire','referentiel') ?> </b>
     <br />
<?php
		echo '<input type="radio" name="mailnow" value="1" />'.get_string('yes').' &nbsp; <input type="radio" name="mailnow" value="0" checked="checked" />'.get_string('no').' &nbsp; &nbsp; '."\n";
?>
    </td>
</tr>

<tr valign="top">
    <td align="center" colspan="4">
<input type="hidden" name="select_acc" value="<?php echo $select_acc; ?>" />		
<input type="hidden" name="userid" value="<?php echo $userid; ?>" />
<input type="hidden" name="comment" value="<?php echo $activite_id; ?>" />
<input type="hidden" name="activite_id" value="<?php  echo $activite_id; ?>" />
<!-- These hidden variables are always the same -->
<input type="hidden" name="course"        value="<?php  p($course) ?>" />
<input type="hidden" name="sesskey"     value="<?php  p(sesskey()) ?>" />
<?php
        if (!empty($old_mode)){
            echo '<input type="hidden" name="mode" value="'.$old_mode.'" />'."\n";
        }
        else{
            echo '<input type="hidden" name="mode" value="listactivityall" />'."\n";
        }
?>

<input type="submit" value="<?php  print_string("savechanges") ?>" />
<input type="submit" name="cancel" value="<?php  print_string("quit","referentiel") ?>" />
</td</tr>
</table>
</form>	

<?php
		
	}
}
?>